# LINEトーク履歴解析 単語カウントルール

## 概要

本ドキュメントでは、LINEトーク履歴解析における単語カウントのルールを説明します。

---

## 単語カウント方法の仕様

### 形態素解析

- 単語の抽出には **MeCab** （形態素解析ライブラリ）を使用しています。
- 辞書は**mecab-ipadic-neologd** を使用しています。
  - 新語・固有名詞の認識精度が高い
  - 「dアニメストア」「シャニマス」などの複合語を正しく認識
  - 定期的に更新される最新の辞書
- すべての品詞で表層形（ユーザーが実際に使った言葉そのまま）を使用します。

### 抽出対象の品詞

以下の品詞が抽出対象です。  
あくまで「流行語大賞」的な観点で面白い単語を抽出することを目的としているため、汎用的・実用的・機械的な単語は除外しています。

| 品詞 | 対象細分類 | 対象例 |
|------|-----------|--------|
| 名詞 | 非自立、代名詞、数以外全般 | 「ガンダム」「プラモデル」「東京」「ストア」「稀」 |
| 形容詞 | 非自立、接尾以外全般 | 「荒い」「美しい」「すごい」 |
| 感動詞 | すべて | 「わあ」「おお」 |
| 記号 | 絵文字 | 「😭」「😂」「🙏」 |

以下の品詞は抽出対象外です。

| 品詞 | 除外細分類・説明 | 除外例 |
|------|----------------|--------|
| 名詞 | 非自立、代名詞、数 | 「こと」「もの」「これ」「それ」「1」「2」 |
| 形容詞 | 非自立、接尾 | 「ない」「づらい」「がたい」「っぽい」「らしい」 |
| 動詞 | すべて | 「走る」「食べる」「する」 |
| 助詞 | すべて | 「は」「が」「を」「に」「で」 |
| 助動詞 | すべて | 「です」「ます」「た」「だ」 |
| 副詞 | すべて | 「とても」「すごく」「かなり」 |
| 連体詞 | すべて | 「この」「その」「あの」 |
| 接続詞 | すべて | 「しかし」「だから」「そして」 |
| 接頭詞 | すべて | 「お」「ご」「不」 |
| 記号 | 絵文字以外 | 「！」「。」「、」 |

### 連続名詞の結合

固有名詞を正確にカウントするため、連続する名詞を1つの単語として結合します。  
以下の細分類の名詞が連続する場合に結合されます。

| 細分類 | 説明 | 例 |
|--------|------|-----|
| 一般 | 一般名詞 | 「プラモデル」「アニメ」 |
| 固有名詞 | 固有名詞 | 「ガンダム」「東京」 |
| サ変接続 | サ変接続 | 「ストア」「センター」 |
| 形容動詞語幹 | 形容動詞語幹 | 「稀」 |

例：「マイティーストライクフリーダムガンダム」→「マイティー」（固有名詞）「ストライクフリーダムガンダム」（固有名詞）→ 結合 → 「マイティーストライクフリーダムガンダム」（1単語）

### 絵文字の扱い

#### 絵文字の品詞統一

**MeCabが絵文字を「記号」と「名詞」で交互に認識する問題を解決するため、絵文字を含む単語は全て「記号」として統一しています。**

| 入力 | MeCab解析（本来） | 品詞統一後 |
|------|------------------|-----------|
| 😭😭😭 | 😭（記号）+ 😭（名詞）+ 😭（記号） | 😭（記号）+ 😭（記号）+ 😭（記号） |

#### 連続絵文字の結合

「😭😭😭😭😭😭」などと絵文字を連打して感情を表現する人がいますが、絵文字1つ1つを1文字にカウントしていると膨大な数となってしまうため、連続する絵文字は1単語として結合します。

結合の例

| 入力 | 結合結果 |
|------|---------|
| 😭😭😭 | 😭😭😭（1単語） |
| 😂😂😂😂😂 | 😂😂😂😂😂（1単語） |
| 😭😂🙏 | 😭😂🙏（1単語） |

### 除外単語

#### 1文字のひらがな・カタカナ

ひらがな・カタカナの1字は相槌や感嘆詞として使われることが多く、流行語として面白みに欠けるため除外されます。

#### ストップワードリスト

頻出するが意味の薄い単語を除外します。

| カテゴリ | 除外単語 |
|---------|---------|
| 基本的な動詞・形容詞 | する、ある、いる、なる、やる、できる、出来る、いい、ない |
| 指示語 | そう、こう、ああ、どう、これ、それ、あれ、どれ、ここ、そこ、あそこ、どこ |
| 敬称 | さん、くん、君、ちゃん、様 |
| 抽象名詞 | もの、物、こと、事、ため、為、ところ、所、とき、よう、やつ、奴、人、方 |
| 時間関連 | 今日、明日、昨日、明後日、一昨日、今年、来年、去年、毎日、毎週、毎月、毎年、朝、昼、夜、今朝、今昼、今夜、午前、午後、時間、今、日、時、年、分、月、週、ヶ月 |
| 接続詞・副詞 | あと、しかし、だから、そして、でも、また、さらに、ただ、もし |
| 基本語 | 前、後、左、右、上、下、中、外、内、間、毎、回 |
| その他 | すぎる、すぎ、たち |

#### システムメッセージの除外

以下のメッセージは解析対象外です。

##### 特殊メッセージ

| パターン | 例 |
|---------|-----|
| `[スタンプ]` | スタンプ送信 |
| `[写真]` | 画像送信 |
| `[動画]` | 動画送信 |
| `[ファイル]` | ファイル送信 |
| `[アルバム]` | アルバム作成 |
| `[ノート]` | ノート作成 |
| `[ボイスメッセージ]` | ボイスメッセージ送信 |

##### 通話関連メッセージ

| パターン | 例（iPhone版） | 例（Android版） |
|---------|--------------|----------------|
| 不在着信 | `☎ 不在着信` | `不在着信` |
| 応答なし通知 | `☎ 通話に応答がありませんでした` | `通話に応答がありませんでした` |
| 通話時間記録 | `☎ 通話時間 0:38` | `通話時間 2:49` |
| 通話キャンセル通知 | `☎ 通話をキャンセルしました` | `通話をキャンセルしました。` |
| グループ通話開始通知 | `☎ グループ通話が開始されました。` | `グループ音声通話が開始されました。`<br>`グループビデオ通話が開始されました。` |
| グループ通話終了通知 | `グループ通話が終了しました。` | `グループ通話が終了しました。` |

##### メンバー変更メッセージ

| パターン | 例 |
|---------|-----|
| `〇〇が参加しました。` | メンバー参加 |
| `〇〇が退出しました。` | メンバー退出 |
| `〇〇がメンバーを追加しました。` | メンバー追加 |
| `〇〇がメンバーを削除しました。` | メンバー削除 |

#### URLの除外

**メッセージ本文からURLが自動的に除外されます。**

| 元のメッセージ | 処理後 |
|--------------|--------|
| これ見て https://example.com すごい | これ見て すごい |
| https://example.com | （メッセージ自体が除外） |

---

### カウントルールの処理順序

全体フローは以下の通りです。

```
1. LINEトーク履歴の読み込み
   ↓
2. メッセージの抽出（システムメッセージ・URL除外）
   ↓
3. 形態素解析（MeCab）
   ↓
4. 絵文字の連続結合
   ↓
5. 名詞の連続結合
   ↓
6. 絵文字を含まない記号の除外
   ↓
7. 品詞・細分類フィルタリング
   ↓
8. 文字数フィルタリング
   ↓
9. ストップワードフィルタリング
   ↓
10. 単語カウント
   ↓
11. メッセージ全文カウント
   ↓
12. 上位N件の抽出
```

## メッセージ全文カウント方法の仕様

「ミーム」を適切にカウントするため、メッセージ全文を1つの単語として扱い、完全一致でカウントします。

| メッセージ | カウント結果 |
|-----------|-------------|
| それな | それな: 1回 |
| それな | それな: 2回 |
| それな＾＾ | それな＾＾: 1回 |

---

**最終更新**: 2025-12-30
