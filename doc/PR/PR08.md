# PR#8: FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹ç¯‰

## ğŸ“‹ æ¦‚è¦
FastAPIã‚’ä½¿ç”¨ã—ãŸREST APIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨è§£æã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã€CORSå¯¾å¿œã€è¨­å®šç®¡ç†ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’å«ã‚€å®Œå…¨ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚12ã®çµ±åˆãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šã€å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œã‚’æ¤œè¨¼ã—ã€å…¨ä½“ã§88%ã®ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é”æˆã—ã¦ã„ã¾ã™ã€‚

## ğŸ¯ ç›®çš„
- FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
- CORSè¨­å®šã«ã‚ˆã‚‹ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è¨±å¯
- ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æä¾›
- ãƒˆãƒ¼ã‚¯å±¥æ­´è§£æã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æä¾›
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ä»•æ§˜æ›¸ï¼ˆSPEC.md section 4, 6, 7ï¼‰é€šã‚Šã®APIä»•æ§˜ã®å®Ÿç¾

## ğŸ”§ å¤‰æ›´å†…å®¹

### 1. app/core/config.py
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

**Settingsã‚¯ãƒ©ã‚¹**
- ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šå€¤ã‚’èª­ã¿è¾¼ã‚€
- **è¨­å®šé …ç›®**
  - `APP_NAME`: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "LINE Talk Analyzer"ï¼‰
  - `APP_VERSION`: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "1.0.0"ï¼‰
  - `ALLOWED_ORIGINS`: CORSè¨±å¯ã‚ªãƒªã‚¸ãƒ³ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "http://localhost:3000"ï¼‰
  - `MAX_FILE_SIZE_MB`: æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50MBï¼‰
  - `MAX_FILE_SIZE_BYTES`: æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆå˜ä½ï¼‰
  - `DEFAULT_TOP_N`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¸Šä½å–å¾—æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
  - `MIN_WORD_LENGTH`: æœ€å°å˜èªé•·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ï¼‰
  - `MIN_MESSAGE_LENGTH`: æœ€å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é•·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2ï¼‰

**get_settings()é–¢æ•°**
- `@lru_cache()`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚Šã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§åŒã˜è¨­å®šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å…±æœ‰

### 2. app/core/cors.py
CORSï¼ˆCross-Origin Resource Sharingï¼‰è¨­å®š

**setup_cors()é–¢æ•°**
- FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è¿½åŠ 
- **è¨­å®šå†…å®¹**
  - `allow_origins`: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚“ã ã‚ªãƒªã‚¸ãƒ³ãƒªã‚¹ãƒˆ
  - `allow_credentials`: Trueï¼ˆèªè¨¼æƒ…å ±ã‚’å«ã‚€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ï¼‰
  - `allow_methods`: ["GET", "POST"]
  - `allow_headers`: ["*"]ï¼ˆå…¨ã¦ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨±å¯ï¼‰

### 3. app/api/v1/endpoints/health.py
ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**GET /api/v1/health**
- APIãŒæ­£å¸¸ã«ç¨¼åƒã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
  ```json
  {
    "status": "ok",
    "version": "1.0.0"
  }
  ```

### 4. app/api/v1/endpoints/analyze.py
ãƒˆãƒ¼ã‚¯å±¥æ­´è§£æã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**POST /api/v1/analyze**
- LINEãƒˆãƒ¼ã‚¯å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦è§£æ
- **ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆmultipart/form-dataï¼‰**
  - `file`: LINEãƒˆãƒ¼ã‚¯å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¿…é ˆã€.txtå½¢å¼ï¼‰
  - `top_n`: å–å¾—ã™ã‚‹ä¸Šä½å˜èªæ•°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - `min_word_length`: æœ€å°å˜èªé•·ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - `max_word_length`: æœ€å¤§å˜èªé•·ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - `min_message_length`: æœ€å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é•·ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - `max_message_length`: æœ€å¤§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é•·ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - `start_date`: è§£æé–‹å§‹æ—¥æ™‚ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€YYYY-MM-DD HH:MM:SSå½¢å¼ï¼‰
  - `end_date`: è§£æçµ‚äº†æ—¥æ™‚ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€YYYY-MM-DD HH:MM:SSå½¢å¼ï¼‰

- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
  - ãƒ•ã‚¡ã‚¤ãƒ«åã®å­˜åœ¨ç¢ºèª
  - .txtæ‹¡å¼µå­ã®ãƒã‚§ãƒƒã‚¯
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆæœ€å¤§50MBï¼‰
  - ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚§ãƒƒã‚¯
  - UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ãƒã‚§ãƒƒã‚¯
  - æ—¥æ™‚å½¢å¼ã®ãƒã‚§ãƒƒã‚¯

- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
  - `400 Bad Request`: ãƒ•ã‚¡ã‚¤ãƒ«æœªæŒ‡å®šã€ä¸æ­£ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã€ä¸æ­£ãªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ä¸æ­£ãªæ—¥æ™‚å½¢å¼ã€è§£æã‚¨ãƒ©ãƒ¼
  - `413 Payload Too Large`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…é
  - `500 Internal Server Error`: ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼

- **_parse_datetime()é–¢æ•°**
  - æ—¥æ™‚æ–‡å­—åˆ—ã‚’datetimeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
  - YYYY-MM-DD HH:MM:SSå½¢å¼ã¨YYYY-MM-DDå½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ

### 5. app/api/v1/router.py
API v1ãƒ«ãƒ¼ã‚¿ãƒ¼

- å…¨ã¦ã®v1ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çµ±åˆ
- `/api/v1`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¨­å®š
- healthã€analyzeã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç™»éŒ²
- ã‚¿ã‚°ã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–

### 6. app/main.py
FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–**
- è¨­å®šã‚’å–å¾—ï¼ˆ`get_settings()`ï¼‰
- FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
  - ã‚¿ã‚¤ãƒˆãƒ«ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€èª¬æ˜ã‚’è¨­å®šã‹ã‚‰å–å¾—
- CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è¨­å®š
- v1ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ç™»éŒ²

**GET /**
- ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- APIåŸºæœ¬æƒ…å ±ã‚’è¿”ã™
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
  ```json
  {
    "message": "Welcome to LINE Talk Analyzer API",
    "version": "1.0.0",
    "docs": "/docs"
  }
  ```

### 7. tests/integration/test_api.py
çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆ12ãƒ†ã‚¹ãƒˆï¼‰

**TestHealthEndpointï¼ˆ1ãƒ†ã‚¹ãƒˆï¼‰**
- `test_health_check`: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**TestRootEndpointï¼ˆ1ãƒ†ã‚¹ãƒˆï¼‰**
- `test_root`: ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**TestAnalyzeEndpointï¼ˆ9ãƒ†ã‚¹ãƒˆï¼‰**
- `test_analyze_success`: æ­£å¸¸ç³» - è§£æãŒæˆåŠŸ
- `test_analyze_with_parameters`: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®šã‚ã‚Š
- `test_analyze_with_date_range`: æœŸé–“æŒ‡å®šã‚ã‚Š
- `test_analyze_no_file`: ç•°å¸¸ç³» - ãƒ•ã‚¡ã‚¤ãƒ«ãªã—
- `test_analyze_invalid_file_extension`: ç•°å¸¸ç³» - ä¸æ­£ãªæ‹¡å¼µå­
- `test_analyze_empty_file`: ç•°å¸¸ç³» - ç©ºãƒ•ã‚¡ã‚¤ãƒ«
- `test_analyze_invalid_encoding`: ç•°å¸¸ç³» - ä¸æ­£ãªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- `test_analyze_invalid_date_format`: ç•°å¸¸ç³» - ä¸æ­£ãªæ—¥æ™‚å½¢å¼
- `test_analyze_large_file`: ç•°å¸¸ç³» - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…é

**TestCORSï¼ˆ1ãƒ†ã‚¹ãƒˆï¼‰**
- `test_cors_headers`: CORSãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèª

### 8. requirements.txt / requirements-ci.txt
- `httpx==0.27.2`ã‚’è¿½åŠ ï¼ˆFastAPI TestClientç”¨ï¼‰

### 9. æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«
- `/app/app/core/__init__.py`
- `/app/app/core/config.py`
- `/app/app/core/cors.py`
- `/app/app/api/__init__.py`
- `/app/app/api/v1/__init__.py`
- `/app/app/api/v1/router.py`
- `/app/app/api/v1/endpoints/__init__.py`
- `/app/app/api/v1/endpoints/health.py`
- `/app/app/api/v1/endpoints/analyze.py`
- `/app/tests/integration/__init__.py`
- `/app/tests/integration/test_api.py`

## âœ… ãƒ†ã‚¹ãƒˆçµæœ

### çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ
```bash
$ pytest tests/integration/test_api.py -v
======================== test session starts =========================
collected 12 items

tests/integration/test_api.py::TestHealthEndpoint::test_health_check PASSED           [  8%]
tests/integration/test_api.py::TestRootEndpoint::test_root PASSED                     [ 16%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_success PASSED       [ 25%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_with_parameters PASSED [ 33%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_with_date_range PASSED [ 41%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_no_file PASSED       [ 50%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_invalid_file_extension PASSED [ 58%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_empty_file PASSED     [ 66%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_invalid_encoding PASSED [ 75%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_invalid_date_format PASSED [ 83%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_large_file PASSED     [ 91%]
tests/integration/test_api.py::TestCORS::test_cors_headers PASSED                      [100%]

======================== 12 passed in 1.34s ==========================
```

**çµæœ**: âœ… å…¨12ãƒ†ã‚¹ãƒˆæˆåŠŸ

### ã‚«ãƒãƒ¬ãƒƒã‚¸çµæœ
```bash
$ pytest tests/integration/test_api.py --cov=app --cov-report=term-missing
---------- coverage: platform linux, python 3.11.14-final-0 ----------
Name                               Stmts   Miss  Cover   Missing
----------------------------------------------------------------
app/__init__.py                        1      0   100%
app/api/__init__.py                    2      0   100%
app/api/v1/__init__.py                 2      0   100%
app/api/v1/endpoints/__init__.py       1      0   100%
app/api/v1/endpoints/analyze.py       52      5    90%   59, 115-118
app/api/v1/endpoints/health.py         7      0   100%
app/api/v1/router.py                   5      0   100%
app/core/__init__.py                   2      0   100%
app/core/config.py                    17      0   100%
app/core/cors.py                       5      0   100%
app/main.py                           11      0   100%
app/models/__init__.py                 3      0   100%
app/models/request.py                 19      9    53%
app/models/response.py                45      0   100%
app/services/__init__.py               4      0   100%
app/services/analyzer.py              75     10    87%
app/services/morphological.py         62      9    85%
app/services/parser.py                72     10    86%
app/services/word_counter.py          93     15    84%
----------------------------------------------------------------
TOTAL                                478     58    88%
```

**çµæœ**: âœ… 88% (420/478ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ)

### ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
```bash
$ black app tests/integration && isort app tests/integration
All done! âœ¨ ğŸ° âœ¨
6 files reformatted, 15 files left unchanged.

$ flake8 app tests/integration --max-line-length=100 --ignore=...
[å‡ºåŠ›ãªã— - ã‚¨ãƒ©ãƒ¼ãªã—]

$ mypy app --config-file=mypy.ini
Success: no issues found in 19 source files
```

**çµæœ**: âœ… å…¨ã¦ã®ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã‚’ãƒ‘ã‚¹

## ğŸ’¡ å­¦ã‚“ã ã“ã¨ãƒ»å·¥å¤«ã—ãŸç‚¹

### 1. è¨­å®šç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- `@lru_cache()`ã«ã‚ˆã‚‹ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¨­å®šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å…±æœ‰
- ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã®èª­ã¿è¾¼ã¿ã§ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã«å¿œã˜ãŸæŸ”è»Ÿãªè¨­å®š
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®æä¾›ã§é–‹ç™ºç’°å¢ƒã§ã‚‚å³åº§ã«å‹•ä½œ

### 2. FastAPIã®éåŒæœŸå‡¦ç†
- `async def`ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’éåŒæœŸåŒ–
- `await file.read()`ã§å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã‚‚åŠ¹ç‡çš„ã«å‡¦ç†

### 3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤šå±¤åŒ–
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼**: æ‹¡å¼µå­ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€æ—¥æ™‚å½¢å¼
- **ã‚µã‚¤ã‚ºæ¤œè¨¼**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ã€ç©ºãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼**: analyzerå†…éƒ¨ã§ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼
- ã‚¨ãƒ©ãƒ¼ã¯é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§è¿”å´

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥
- `HTTPException`ã«ã‚ˆã‚‹çµ±ä¸€çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªæ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- å„æ®µéšã§ã®try-exceptã«ã‚ˆã‚‹è©³ç´°ãªã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®é©åˆ‡ãªä½¿ã„åˆ†ã‘ï¼ˆ400, 413, 500ï¼‰

### 5. CORSè¨­å®šã®å®Ÿè£…
- `CORSMiddleware`ã‚’ä½¿ç”¨ã—ãŸç°¡æ½”ãªå®Ÿè£…
- ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹æŸ”è»Ÿãªã‚ªãƒªã‚¸ãƒ³è¨­å®š
- é–‹ç™ºç’°å¢ƒï¼ˆlocalhostï¼‰ã¨ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã®ä¸¡å¯¾å¿œ

### 6. TestClientã®æ´»ç”¨
- FastAPIã®`TestClient`ã§å®Ÿéš›ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
- `BytesIO`ã‚’ä½¿ç”¨ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ
- æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ã‚’ç¶²ç¾…çš„ã«ãƒ†ã‚¹ãƒˆ

### 7. æ—¥æ™‚ãƒ‘ãƒ¼ã‚¹ã®æŸ”è»Ÿæ€§
- è¤‡æ•°ã®æ—¥æ™‚å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆYYYY-MM-DD HH:MM:SSã€YYYY-MM-DDï¼‰
- æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æœŸå¾…ã•ã‚Œã‚‹å½¢å¼ã‚’é€šçŸ¥

### 8. APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è‡ªå‹•ç”Ÿæˆ
- FastAPIã®æ©Ÿèƒ½ã«ã‚ˆã‚Š`/docs`ã§è‡ªå‹•çš„ã«Swagger UIãŒç”Ÿæˆã•ã‚Œã‚‹
- å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨docstringã‹ã‚‰è©³ç´°ãªAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã‚‹

## ğŸ› ç™ºè¦‹ãƒ»ä¿®æ­£ã—ãŸå•é¡Œ

### å•é¡Œ1: httpxãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
**å†…å®¹**: TestClientã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«httpxãŒå¿…è¦

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
ModuleNotFoundError: No module named 'httpx'
```

**ä¿®æ­£**:
- `requirements.txt`ã¨`requirements-ci.txt`ã«`httpx==0.27.2`ã‚’è¿½åŠ 

**å½±éŸ¿**: çµ±åˆãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œå¯èƒ½ã«

### å•é¡Œ2: mypyã®å‹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼
**å†…å®¹**: 
- `__all__`ã«å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦
- ifæ–‡ã§ã®Noneãƒã‚§ãƒƒã‚¯å¾Œã«unreachableã‚¨ãƒ©ãƒ¼

**ä¿®æ­£**:
- `__all__: list[str] = []`ã«å¤‰æ›´
- `top_n = top_n if top_n is not None else settings.DEFAULT_TOP_N`ã®ã‚ˆã†ã«ä¸‰é …æ¼”ç®—å­ã§è¨˜è¿°

**å½±éŸ¿**: å‹å®‰å…¨æ€§ãŒå‘ä¸Š

### å•é¡Œ3: CORSãƒ†ã‚¹ãƒˆã®å¤±æ•—
**å†…å®¹**: OPTIONSãƒ¡ã‚½ãƒƒãƒ‰ãŒ405ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™

**ä¿®æ­£**:
- OPTIONSã§ã¯ãªãGETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç¢ºèªã™ã‚‹ã‚ˆã†ã«å¤‰æ›´
- `access-control-allow-origin`ãƒ˜ãƒƒãƒ€ãƒ¼ã®å­˜åœ¨ã‚’ç¢ºèª

**å½±éŸ¿**: CORSãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«

## ğŸ“Š çµ±è¨ˆæƒ…å ±
- **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 11ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ–°è¦ä½œæˆï¼‰
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 1ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ–°è¦ä½œæˆï¼‰
- **ãƒ†ã‚¹ãƒˆæ•°**: 12
- **å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸**: 88% (420/478ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ)
- **æ–°è¦è¿½åŠ ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆæ•°**: ç´„100ï¼ˆAPIå±¤ã®ã¿ï¼‰
- **å¹³å‡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: 1.34ç§’

## ğŸš€ å‹•ä½œç¢ºèª

### ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
$ uvicorn app.main:app --reload
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345] using StatReload
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- Swagger UI: http://127.0.0.1:8000/docs
- ReDoc: http://127.0.0.1:8000/redoc

### cURLã§ã®ãƒ†ã‚¹ãƒˆ
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
$ curl http://localhost:8000/api/v1/health
{"status":"ok","version":"1.0.0"}

# è§£æï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
$ curl -X POST http://localhost:8000/api/v1/analyze \
  -F "file=@test.txt" \
  -F "top_n=10"
```

## ğŸ”„ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (PR#9)
E2Eãƒ†ã‚¹ãƒˆã¨æœ€çµ‚èª¿æ•´ã«é€²ã¿ã¾ã™ï¼š
- å®Ÿéš›ã®LINEãƒˆãƒ¼ã‚¯å±¥æ­´ã‚’ä½¿ç”¨ã—ãŸE2Eãƒ†ã‚¹ãƒˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®šï¼‰
- å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆ
- README.mdã®å®Œæˆ
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å……å®Ÿ

---

## ğŸ”§ ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œãƒ»ä¿®æ­£å±¥æ­´

### ãƒ¬ãƒ“ãƒ¥ãƒ¼1: Form(None)ã®æ˜ç¤ºåŒ–
**æŒ‡æ‘˜å†…å®¹**: `Form(None)`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€`Form(default=None)`ã¨æ˜ç¤ºçš„ã«è¨˜è¿°ã™ã‚‹æ–¹ãŒå¯èª­æ€§ã¨æ„å›³ãŒæ˜ç¢º

**ä¿®æ­£å†…å®¹**:
- `app/api/v1/endpoints/analyze.py`ã®Formå®šç¾©ã‚’ä¿®æ­£
- `Form(None)` â†’ `Form(default=None)`ã«å¤‰æ›´

**å½±éŸ¿**: ã‚³ãƒ¼ãƒ‰ã®æ„å›³ãŒæ˜ç¢ºåŒ–ã•ã‚Œã€å¯èª­æ€§ãŒå‘ä¸Š

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼2: ç’°å¢ƒå¤‰æ•°ã®æ•´æ•°å¤‰æ›ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
**æŒ‡æ‘˜å†…å®¹**: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’`int()`ã§å¤‰æ›ã—ã¦ã„ã‚‹ãŒã€ç„¡åŠ¹ãªå€¤ãŒè¨­å®šã•ã‚ŒãŸå ´åˆã«`ValueError`ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

**ä¿®æ­£å†…å®¹**:
- `app/core/config.py`ã«`_get_int_env()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè£…
- `warnings.warn()`ã§è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

**ãƒ†ã‚¹ãƒˆè¿½åŠ **:
- `tests/unit/test_config.py`ã‚’æ–°è¦ä½œæˆï¼ˆ6ãƒ†ã‚¹ãƒˆï¼‰
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ãƒ†ã‚¹ãƒˆ
  - ã‚«ã‚¹ã‚¿ãƒ ç’°å¢ƒå¤‰æ•°ã®ãƒ†ã‚¹ãƒˆ
  - ç„¡åŠ¹ãªæ•´æ•°å€¤ã®ãƒ†ã‚¹ãƒˆ
  - ã‚ªãƒªã‚¸ãƒ³è§£æã®ãƒ†ã‚¹ãƒˆ
  - ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®ãƒ†ã‚¹ãƒˆ

**ã‚³ãƒ¼ãƒ‰ä¾‹**:
```python
def _get_int_env(self, key: str, default: int) -> int:
    value_str = os.getenv(key)
    if value_str is None:
        return default
    try:
        return int(value_str)
    except ValueError:
        warnings.warn(
            f"ç’°å¢ƒå¤‰æ•° {key} ã®å€¤ '{value_str}' ã¯æ•´æ•°ã«å¤‰æ›ã§ãã¾ã›ã‚“ã€‚"
            f"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ {default} ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚",
            UserWarning,
            stacklevel=2,
        )
        return default
```

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨6ãƒ†ã‚¹ãƒˆæˆåŠŸ

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼3: ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã®ãƒ¡ãƒ¢ãƒªåŠ¹ç‡æ”¹å–„
**æŒ‡æ‘˜å†…å®¹**: ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ä¸€åº¦ã«ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚“ã§ã„ã‚‹ãŸã‚ã€å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆãƒ¡ãƒ¢ãƒªä¸è¶³ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

**ä¿®æ­£å†…å®¹**:
- `app/api/v1/endpoints/analyze.py`ã§ãƒãƒ£ãƒ³ã‚¯å˜ä½ï¼ˆ1MBï¼‰ã®èª­ã¿è¾¼ã¿ã«å¤‰æ›´
- ã‚µã‚¤ã‚ºåˆ¶é™ã‚’è¶…ãˆãŸæ™‚ç‚¹ã§å³åº§ã«å‡¦ç†ã‚’ä¸­æ–­
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æœ€å¤§50MBã«åˆ¶é™

**ãƒ†ã‚¹ãƒˆè¿½åŠ **:
- `test_analyze_file_at_size_limit`: 50MBå¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ
- `test_analyze_chunked_reading`: 5MBãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ£ãƒ³ã‚¯èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ

**ã‚³ãƒ¼ãƒ‰ä¾‹**:
```python
chunk_size = 1024 * 1024  # 1MB
content_chunks: list[bytes] = []
file_size = 0

while True:
    chunk = await file.read(chunk_size)
    if not chunk:
        break
    file_size += len(chunk)
    if file_size > settings.MAX_FILE_SIZE_BYTES:
        raise HTTPException(status_code=413, detail=...)
    content_chunks.append(chunk)

content = b"".join(content_chunks)
```

**æ”¹å–„åŠ¹æœ**:
- Before: 100MBã®ãƒ•ã‚¡ã‚¤ãƒ« â†’ å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰413ã‚¨ãƒ©ãƒ¼
- After: 100MBã®ãƒ•ã‚¡ã‚¤ãƒ« â†’ 50MBèª­ã¿è¾¼ã‚“ã æ™‚ç‚¹ã§å³åº§ã«413ã‚¨ãƒ©ãƒ¼

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨11ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ2ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼‰

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼4: å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ­£ç¢ºæ€§å‘ä¸Š
**æŒ‡æ‘˜å†…å®¹**: `setup_cors()`ã§`Starlette`å‹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã¯`FastAPI`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ¸¡ã•ã‚Œã‚‹

**ä¿®æ­£å†…å®¹**:
- `app/core/cors.py`ã®å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿®æ­£
- `from starlette.applications import Starlette` â†’ `from fastapi import FastAPI`
- `app: Starlette` â†’ `app: FastAPI`

**å½±éŸ¿**: å‹æƒ…å ±ãŒã‚ˆã‚Šæ­£ç¢ºã«ãªã‚Šã€IDEã®è£œå®ŒãŒæ”¹å–„

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼5: TalkAnalyzerã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³åŒ–ï¼ˆDependency Injectionï¼‰
**æŒ‡æ‘˜å†…å®¹**: `TalkAnalyzer()`ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«æ–°ã—ãã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ã„ã‚‹ãŒã€MeCabã®åˆæœŸåŒ–ã¯ã‚³ã‚¹ãƒˆãŒé«˜ã„

**ä¿®æ­£å†…å®¹**:
1. **main.py**: lifespanã‚¤ãƒ™ãƒ³ãƒˆã‚’å®Ÿè£…
   ```python
   @asynccontextmanager
   async def lifespan(app: FastAPI) -> AsyncGenerator[None, None]:
       app.state.analyzer = TalkAnalyzer()
       yield
   
   app = FastAPI(..., lifespan=lifespan)
   ```

2. **analyze.py**: Dependency Injectionå®Ÿè£…
   ```python
   def get_analyzer(request: Request) -> TalkAnalyzer:
       return cast(TalkAnalyzer, request.app.state.analyzer)
   
   async def analyze_talk(
       ...
       analyzer: TalkAnalyzer = Depends(get_analyzer),
   ) -> AnalysisResult:
       result = analyzer.analyze(...)  # æ–°è¦ä½œæˆã›ãšæ³¨å…¥ã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
   ```

3. **test_api.py**: ãƒ†ã‚¹ãƒˆç”¨ã®åˆæœŸåŒ–
   ```python
   app.state.analyzer = TalkAnalyzer()
   client = TestClient(app)
   ```

**æ”¹å–„åŠ¹æœ**:
- Before: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«MeCabåˆæœŸåŒ–ï¼ˆæ•°ç™¾mså¢—åŠ ï¼‰
- After: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«1åº¦ã ã‘åˆæœŸåŒ–ã€ä»¥é™ã¯å†åˆ©ç”¨

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨20ãƒ†ã‚¹ãƒˆæˆåŠŸ

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼6: 500ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸è¿½åŠ 
**æŒ‡æ‘˜å†…å®¹**: æ±ç”¨çš„ãª`Exception`å‡¦ç†ï¼ˆ500ã‚¨ãƒ©ãƒ¼ï¼‰ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒãªã„

**ä¿®æ­£å†…å®¹**:
- `test_analyze_server_error`ã‚’è¿½åŠ 
- `unittest.mock`ã‚’ä½¿ç”¨ã—ã¦TalkAnalyzerã‚’ãƒ¢ãƒƒã‚¯
- `RuntimeError`ã‚’ç™ºç”Ÿã•ã›ã¦500ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

**ã‚³ãƒ¼ãƒ‰ä¾‹**:
```python
def test_analyze_server_error(self, sample_talk_file: BytesIO) -> None:
    with mock.patch.object(
        TalkAnalyzer, "analyze", side_effect=RuntimeError("äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼")
    ):
        response = client.post(...)
        assert response.status_code == 500
```

**ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**:
- âœ… 400ã‚¨ãƒ©ãƒ¼: è¤‡æ•°ã®ç•°å¸¸ç³»
- âœ… 413ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…é
- âœ… 422ã‚¨ãƒ©ãƒ¼: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- âœ… **500ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ï¼ˆNEWï¼‰**

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨21ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ1ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼‰

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼7: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ”¹å–„ã¨ãƒ­ã‚®ãƒ³ã‚°å®Ÿè£…
**æŒ‡æ‘˜å†…å®¹**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œè§£æã‚¨ãƒ©ãƒ¼: {str(e)}ã€ã¯ã€å…ƒã®ä¾‹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãã®ã¾ã¾éœ²å‡ºã—ã¦ãŠã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒã‚ã‚‹

**ä¿®æ­£å†…å®¹**:
1. **ãƒ­ã‚®ãƒ³ã‚°è¿½åŠ **:
   ```python
   import logging
   logger = logging.getLogger(__name__)
   ```

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„**:
   ```python
   except ValueError as e:
       logger.warning("è§£æå‡¦ç†ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: %s", str(e), exc_info=True)
       raise HTTPException(
           status_code=400,
           detail="ãƒˆãƒ¼ã‚¯å±¥æ­´ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚LINEã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸ.txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚",
       )
   except Exception as e:
       logger.error("è§£æå‡¦ç†ã§äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: %s", str(e), exc_info=True)
       raise HTTPException(
           status_code=500,
           detail="ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
       )
   ```

3. **ãƒ†ã‚¹ãƒˆè¿½åŠ **:
   - `test_analyze_value_error`: ValueErroræ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ: å†…éƒ¨ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒéœ²å‡ºã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª

**æ”¹å–„åŠ¹æœ**:
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š: å†…éƒ¨å®Ÿè£…ã®è©³ç´°ãŒå¤–éƒ¨ã«æ¼ã‚Œãªã„
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: ç†è§£ã—ã‚„ã™ã„æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… ãƒ‡ãƒãƒƒã‚°æ€§å‘ä¸Š: ãƒ­ã‚°ã«è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’è¨˜éŒ²ï¼ˆ`exc_info=True`ã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å«ã‚€ï¼‰

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨22ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ1ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼‰

---

### ãƒ¬ãƒ“ãƒ¥ãƒ¼8: å¾ªç’°ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å›é¿
**æŒ‡æ‘˜å†…å®¹**: `app/api/v1/__init__.py`ã§åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰è‡ªåˆ†è‡ªèº«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€å¾ªç’°ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ãƒªã‚¹ã‚¯ãŒã‚ã‚‹

**ä¿®æ­£å†…å®¹**:
- çµ¶å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆ â†’ ç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤‰æ›´
- `from app.api.v1 import router` â†’ `from .router import router`

**æ”¹å–„åŠ¹æœ**:
- âœ… å¾ªç’°ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å›é¿
- âœ… Pythonã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æº–æ‹ 
- âœ… ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ã®å¤‰æ›´ã«å¼·ã„

**ãƒ†ã‚¹ãƒˆçµæœ**: âœ… å…¨22ãƒ†ã‚¹ãƒˆæˆåŠŸ

---

## ğŸ“ˆ æœ€çµ‚ãƒ†ã‚¹ãƒˆçµæœ

### å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
$ pytest tests/unit/test_config.py tests/integration/test_api.py -v
======================== test session starts =========================
collected 22 items

tests/unit/test_config.py::TestSettings::test_default_values PASSED                   [  4%]
tests/unit/test_config.py::TestSettings::test_custom_env_values PASSED                [  9%]
tests/unit/test_config.py::TestSettings::test_invalid_int_env_values PASSED           [ 13%]
tests/unit/test_config.py::TestSettings::test_parse_origins_with_spaces PASSED        [ 18%]
tests/unit/test_config.py::TestSettings::test_parse_origins_empty_string PASSED       [ 22%]
tests/unit/test_config.py::TestGetSettings::test_singleton PASSED                     [ 27%]
tests/integration/test_api.py::TestHealthEndpoint::test_health_check PASSED           [ 31%]
tests/integration/test_api.py::TestRootEndpoint::test_root PASSED                     [ 36%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_success PASSED       [ 40%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_with_parameters PASSED [ 45%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_with_date_range PASSED [ 50%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_no_file PASSED       [ 54%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_invalid_file_extension PASSED [ 59%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_empty_file PASSED    [ 63%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_invalid_encoding PASSED [ 68%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_invalid_date_format PASSED [ 72%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_large_file PASSED    [ 77%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_file_at_size_limit PASSED [ 81%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_chunked_reading PASSED [ 86%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_server_error PASSED  [ 90%]
tests/integration/test_api.py::TestAnalyzeEndpoint::test_analyze_value_error PASSED   [ 95%]
tests/integration/test_api.py::TestCORS::test_cors_headers PASSED                     [100%]

======================== 22 passed in 2.76s ==========================
```

**çµæœ**: âœ… å…¨22ãƒ†ã‚¹ãƒˆæˆåŠŸ

### ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯æœ€çµ‚ç¢ºèª
```bash
$ black app tests && isort app tests
All done! âœ¨ ğŸ° âœ¨

$ flake8 app tests --max-line-length=100 --ignore=E203,W503,ANN101,ANN204,ANN401,D105,D107,D400,D403,D415,DAR101,DAR201 --select=E,W,F,N,D --docstring-convention=google
[å‡ºåŠ›ãªã— - ã‚¨ãƒ©ãƒ¼ãªã—]

$ mypy app --config-file=mypy.ini
Success: no issues found in 19 source files
```

**çµæœ**: âœ… å…¨ã¦ã®ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã‚’ãƒ‘ã‚¹

### çµ±è¨ˆæƒ…å ±ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œå¾Œï¼‰
- **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 12ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆconfig.py 1è¿½åŠ ï¼‰
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 2ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆtest_config.py 1è¿½åŠ ï¼‰
- **ãƒ†ã‚¹ãƒˆæ•°**: 22ãƒ†ã‚¹ãƒˆï¼ˆåˆæœŸ12 + ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ10è¿½åŠ ï¼‰
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: 88%ä»¥ä¸Šç¶­æŒ
- **ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 7ãƒ•ã‚¡ã‚¤ãƒ«
- **æ–°è¦è¿½åŠ è¡Œæ•°**: ç´„150è¡Œï¼ˆãƒ†ã‚¹ãƒˆå«ã‚€ï¼‰

---

## ğŸ“ å‚™è€ƒ
- **ä¾å­˜PR**: PR#7ï¼ˆçµ±åˆè§£æã‚µãƒ¼ãƒ“ã‚¹ï¼‰
- **å¯¾å¿œä»•æ§˜**: SPEC.md section 4ï¼ˆAPIä»•æ§˜ï¼‰ã€section 6ï¼ˆCORSè¨­å®šï¼‰ã€section 7ï¼ˆè¨­å®šç®¡ç†ï¼‰
- **å®Ÿè£…æœŸé–“**: 2024å¹´12æœˆ12æ—¥
- **æœ€çµ‚æ›´æ–°**: 2024å¹´12æœˆ12æ—¥
